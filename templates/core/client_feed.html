{% extends 'core/base_client.html' %}
{% load static %}

{% block title %}
  Published Feed
{% endblock %}

{% block content %}
  <div class="row">
    <div class="col-12">
      <div class="card mb-4">
        <div class="card-body p-3">
          <div class="page-title-box d-sm-flex align-items-center justify-content-between mb-0">
            <h4 class="font-size-22 fw-bold">Published Feed</h4>

            <div class="page-title-right">
              <ol class="breadcrumb m-0">
                <li class="breadcrumb-item">
                  <a href="{% url 'core:client_dashboard' %}">Dashboard</a>
                </li>
                <li class="breadcrumb-item active">Feed</li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    {% for post in published_posts %}
      <div class="col-lg-4 col-md-6 mb-4">
        <a href="{% url 'posts:client_post_detail' post.id %}" class="text-dark" style="text-decoration: none;">
          <div class="card post-feed-card h-100 d-flex flex-column">
            <div class="post-feed-image-wrapper">
              <img src="{{ post.image.url }}" alt="{{ post.title }}" />
            </div>

            <div class="card-body">
              <h5 class="card-title font-size-16">{{ post.title }}</h5>
              <p class="card-text text-muted">{{ post.caption }}</p>
            </div>

            <div class="card-footer mt-auto">
              <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted">{{ post.scheduled_datetime|date:'F d, Y' }}</small>
                {% if post.avg_rating %}
                  <span class="text-warning fw-bold"><i class="bx bxs-star"></i> {{ post.avg_rating|floatformat:1 }}</span>
                {% else %}
                  <small class="text-muted">Not rated</small>
                {% endif %}
              </div>
            </div>
          </div>
        </a>
      </div>
    {% empty %}
      <div class="col-12">
        <div class="card">
          <div class="card-body text-center py-5">
            <i class="bx bx-images font-size-24 text-muted"></i>
            <p class="text-muted mt-3">Your published posts will appear here.</p>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  {% if published_posts.has_other_pages %}
    <div class="row">
      <div class="col-lg-12">
        <ul class="pagination pagination-rounded justify-content-center mt-4">
          {% if published_posts.has_previous %}
            <li class="page-item">
              <a href="?page={{ published_posts.previous_page_number }}" class="page-link"><i class="bx bx-chevron-left"></i></a>
            </li>
          {% else %}
            <li class="page-item disabled">
              <a href="#" class="page-link"><i class="bx bx-chevron-left"></i></a>
            </li>
          {% endif %}

          {% for i in published_posts.paginator.page_range %}
            <li class="page-item {% if published_posts.number == i %}active{% endif %}">
              <a href="?page={{ i }}" class="page-link">{{ i }}</a>
            </li>
          {% endfor %}

          {% if published_posts.has_next %}
            <li class="page-item">
              <a href="?page={{ published_posts.next_page_number }}" class="page-link"><i class="bx bx-chevron-right"></i></a>
            </li>
          {% else %}
            <li class="page-item disabled">
              <a href="#" class="page-link"><i class="bx bx-chevron-right"></i></a>
            </li>
          {% endif %}
        </ul>
      </div>
    </div>
  {% endif %}
{% endblock %}
